(()=>{const e="Watch on YouTube (Ad-Free)",t="ytv-button",n="www.youtube-nocookie.com",o="yt-video:settings",i={useApiKey:!1,apiKey:"",showThumbnails:!0,autoplay:!0};let c={...i};function a(){const e=Spicetify.PopupModal.display({title:"YT Video Settings",content:`\n      <div style="display: flex; flex-direction: column; gap: 20px; padding: 24px; max-width: 600px; margin: 0 auto;">\n        <div style="display: flex; align-items: center; gap: 12px;">\n          <input type="checkbox" id="ytv-use-api-key" ${c.useApiKey?"checked":""} style="width: 18px; height: 18px;">\n          <label for="ytv-use-api-key" style="font-size: 16px;">Use YouTube API Key (for better search results)</label>\n        </div>\n        <div style="display: flex; flex-direction: column; gap: 12px;">\n          <label for="ytv-api-key" style="font-size: 16px;">YouTube API Key:</label>\n          <input type="text" id="ytv-api-key" value="${c.apiKey}" style="padding: 12px; border-radius: 4px; border: 1px solid #ccc; background: #282828; color: white; font-size: 14px;">\n          <a href="https://developers.google.com/youtube/v3/getting-started" target="_blank" style="color: #1DB954; font-size: 14px;">How to get a YouTube API Key</a>\n        </div>\n        <div style="display: flex; align-items: center; gap: 12px;">\n          <input type="checkbox" id="ytv-show-thumbnails" ${c.showThumbnails?"checked":""} style="width: 18px; height: 18px;">\n          <label for="ytv-show-thumbnails" style="font-size: 16px;">Show video thumbnails in search results</label>\n        </div>\n        <div style="display: flex; align-items: center; gap: 12px;">\n          <input type="checkbox" id="ytv-autoplay" ${c.autoplay?"checked":""} style="width: 18px; height: 18px;">\n          <label for="ytv-autoplay" style="font-size: 16px;">Autoplay videos</label>\n        </div>\n        <div style="display: flex; justify-content: flex-end; gap: 16px; margin-top: 16px;">\n          <button id="ytv-settings-cancel" style="background: #282828; color: white; border: none; padding: 12px 24px; border-radius: 4px; cursor: pointer; font-size: 14px;">Cancel</button>\n          <button id="ytv-settings-save" style="background: #1DB954; color: white; border: none; padding: 12px 24px; border-radius: 4px; cursor: pointer; font-size: 14px;">Save Settings</button>\n        </div>\n      </div>\n    `,isLarge:!0});setTimeout((()=>{const t=document.getElementById("ytv-use-api-key"),n=document.getElementById("ytv-api-key"),i=document.getElementById("ytv-show-thumbnails"),a=document.getElementById("ytv-autoplay"),r=document.getElementById("ytv-settings-cancel"),s=document.getElementById("ytv-settings-save");r&&r.addEventListener("click",(()=>{e.hide()})),s&&s.addEventListener("click",(()=>{c.useApiKey=t?.checked||!1,c.apiKey=n?.value||"",c.showThumbnails=i?.checked||!1,c.autoplay=a?.checked||!1,function(){try{localStorage.setItem(o,JSON.stringify(c)),console.debug("YT-Video: Saved settings:",c)}catch(e){console.error("YT-Video: Error saving settings:",e)}}(),e.hide(),Spicetify.showNotification("Settings saved")}))}),0)}async function r(e,t=null){for(let n=0;n<5;n++){const o=t instanceof Element?t.querySelector(e):document.querySelector(e);if(o)return console.debug(`YT-Video: Found element '${e}' on attempt ${n+1}`),o;await new Promise((e=>setTimeout(e,120)))}return console.warn(`YT-Video: Failed to find element '${e}' after 5 attempts`),null}function s(e){if(!e)return void Spicetify.showNotification("No track information available");if(c.useApiKey&&!c.apiKey)return Spicetify.showNotification("Please set your YouTube API key in settings"),void a();let t;if(e.name&&e.artist)t=`${e.artist} - ${e.name} official video`;else if(!e.name&&e.artist)t=e.artist+" official video";else{if(!e.name||e.artist)return void Spicetify.showNotification("Insufficient track information");t=e.name+" full album"}const o=encodeURIComponent(t);Spicetify.showNotification(`Searching for "${t}" on YouTube...`);const i=Spicetify.PopupModal.display({title:"YT Video Search",content:`\n      <div id="ytv-container" style="width: 100%; height: 80vh;">\n        <div id="ytv-search-bar" style="padding: 8px; display: flex; gap: 8px; align-items: center;">\n          <input type="text" id="ytv-search-input" value="${t}" style="flex: 1; padding: 8px; border-radius: 4px; border: 1px solid #ccc; background: #282828; color: white;">\n          <button id="ytv-search-button" style="background-color: #FF0000; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">Search</button>\n          <button id="ytv-youtube-button" style="background: #282828; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">Open on YouTube</button>\n          <button id="ytv-settings-button" style="background: #282828; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">Settings</button>\n        </div>\n        <div id="ytv-content" style="height: calc(100% - 56px); position: relative;">\n          <div id="ytv-loading" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; background: #121212;">\n            <div class="main-loadingSpinner-spinner"></div>\n          </div>\n        </div>\n      </div>\n    `,isLarge:!0});window.ytvCurrentPopup=i,setTimeout((()=>{const e=document.querySelector(".GenericModal");if(e){e.style.width="80vw",e.style.height="80vh",e.style.maxWidth="80vw",e.style.maxHeight="80vh",e.style.position="fixed",e.style.left="50%",e.style.top="50%",e.style.transform="translate(-50%, -50%)",e.style.zIndex="9999";const t=e.querySelector(".main-trackCreditsModal-mainSection");t&&(t.style.height="calc(80vh - 40px)",t.style.maxHeight="calc(80vh - 40px)",t.style.overflow="hidden");const n=e.querySelector(".main-embedWidgetGenerator-container");n&&(n.style.width="100%",n.style.height="100%",n.style.display="flex",n.style.flexDirection="column",n.style.overflow="hidden");const o=e.querySelector(".main-trackCreditsModal-header");if(o){o.style.padding="8px 16px",o.style.minHeight="40px",o.style.height="40px";const e=o.querySelector(".main-type-alto");e&&(e.style.fontSize="16px",e.style.overflow="hidden",e.style.textOverflow="ellipsis",e.style.whiteSpace="nowrap",e.style.maxWidth="calc(100% - 40px)")}const i=document.querySelector(".GenericModal__overlay");if(i){const e=i.onclick;i.onclick=t=>{t.target===i?e&&e(t):t.stopPropagation()}}const c=document.getElementById("ytv-container");c&&c.addEventListener("click",(e=>{e.stopPropagation()}))}}),100),setTimeout((()=>{const e=document.getElementById("ytv-search-input"),t=document.getElementById("ytv-search-button"),i=document.getElementById("ytv-youtube-button"),r=document.getElementById("ytv-settings-button"),s=document.getElementById("ytv-content"),l=(e,t=0,o=[])=>{console.debug("YT-Video: Showing video player for ID:",e),window.ytvCurrentState={videoId:e,videoIndex:t,videoList:o};const i=document.getElementById("ytv-search-bar");i&&(i.style.display="none");const c=document.querySelector(".main-trackCreditsModal-header");c&&(c.style.display="none"),s.style.height="100%";const a=document.querySelector(".GenericModal");if(a){a.style.padding="0",a.style.margin="0";const e=a.querySelector(".main-trackCreditsModal-mainSection");e&&(e.style.height="100%",e.style.maxHeight="100%",e.style.overflow="hidden",e.style.padding="0",e.style.margin="0");const t=a.querySelector(".main-embedWidgetGenerator-container");t&&(t.style.padding="0",t.style.margin="0");const n=a.querySelector(".main-trackCreditsModal-originalCredits");n&&(n.style.padding="0",n.style.margin="0");const o=document.querySelector(".GenericModal__overlay");o&&(o.style.padding="0")}s.innerHTML="";const r=document.createElement("div");r.id="ytv-player-container",r.style.width="100%",r.style.height="100%",r.style.position="relative",r.style.overflow="hidden",r.style.padding="0",r.style.margin="0",r.style.backgroundColor="#000";const u=document.createElement("iframe");u.id="ytv-player-iframe",u.style.width="100%",u.style.height="100%",u.style.border="none",u.style.padding="0",u.style.margin="0",u.style.display="block",u.style.position="absolute",u.style.top="0",u.style.left="0",u.style.right="0",u.style.bottom="0",u.src=`https://${n}/embed/${e}?autoplay=1&rel=0&controls=1&showinfo=1`,u.allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",u.allowFullscreen=!0;const p=document.createElement("button");p.id="ytv-back-button",p.innerHTML='\n        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="32" height="32" fill="currentColor">\n          <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12l-4.58 4.59z"/>\n        </svg>\n      ',p.style.position="absolute",p.style.top="50%",p.style.left="16px",p.style.transform="translateY(-50%)",p.style.backgroundColor="rgba(0, 0, 0, 0.8)",p.style.color="#ffffff",p.style.border="2px solid rgba(255, 255, 255, 0.3)",p.style.borderRadius="50%",p.style.width="48px",p.style.height="48px",p.style.cursor="pointer",p.style.zIndex="1000",p.style.display="flex",p.style.alignItems="center",p.style.justifyContent="center",p.style.boxShadow="0 2px 8px rgba(0, 0, 0, 0.5)",p.style.transition="all 0.2s ease",p.setAttribute("aria-label","Previous video"),p.setAttribute("title","Previous video");const f=document.createElement("button");f.id="ytv-forward-button",f.innerHTML='\n        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="32" height="32" fill="currentColor">\n          <path d="M8.59 16.59L10 18l6-6-6-6-1.41 1.41L13.17 12l-4.58 4.59z"/>\n        </svg>\n      ',f.style.position="absolute",f.style.top="50%",f.style.right="16px",f.style.transform="translateY(-50%)",f.style.backgroundColor="rgba(0, 0, 0, 0.8)",f.style.color="#ffffff",f.style.border="2px solid rgba(255, 255, 255, 0.3)",f.style.borderRadius="50%",f.style.width="48px",f.style.height="48px",f.style.cursor="pointer",f.style.zIndex="1000",f.style.display="flex",f.style.alignItems="center",f.style.justifyContent="center",f.style.boxShadow="0 2px 8px rgba(0, 0, 0, 0.5)",f.style.transition="all 0.2s ease",f.setAttribute("aria-label","Next video"),f.setAttribute("title","Next video");const y=e=>{e.addEventListener("mouseover",(()=>{e.style.backgroundColor="rgba(255, 0, 0, 0.8)",e.style.borderColor="rgba(255, 255, 255, 0.5)",e.style.transform="translateY(-50%) scale(1.1)"})),e.addEventListener("mouseout",(()=>{e.style.backgroundColor="rgba(0, 0, 0, 0.8)",e.style.borderColor="rgba(255, 255, 255, 0.3)",e.style.transform="translateY(-50%) scale(1)"}))};y(p),y(f),p.addEventListener("click",(e=>{if(e.preventDefault(),e.stopPropagation(),window.ytvCurrentState&&window.ytvCurrentState.videoList&&window.ytvCurrentState.videoList.length>0){const{videoIndex:e,videoList:t}=window.ytvCurrentState;if(e>0){const n=e-1,o=t[n];l(o.id.videoId,n,t)}else{if(console.debug("YT-Video: At first video, going back to search"),i&&(i.style.display="flex"),c&&(c.style.display="flex"),s.style.height="calc(100% - 56px)",a){a.style.padding="";const e=a.querySelector(".main-trackCreditsModal-mainSection");e&&(e.style.height="calc(80vh - 60px)",e.style.maxHeight="calc(80vh - 60px)",e.style.padding="",e.style.margin="");const t=a.querySelector(".main-embedWidgetGenerator-container");t&&(t.style.padding="",t.style.margin="");const n=a.querySelector(".main-trackCreditsModal-originalCredits");n&&(n.style.padding="",n.style.margin="");const o=document.querySelector(".GenericModal__overlay");o&&(o.style.padding="")}d()}}else{if(console.debug("YT-Video: Back button clicked, returning to search"),i&&(i.style.display="flex"),c&&(c.style.display="flex"),s.style.height="calc(100% - 56px)",a){a.style.padding="";const e=a.querySelector(".main-trackCreditsModal-mainSection");e&&(e.style.height="calc(80vh - 60px)",e.style.maxHeight="calc(80vh - 60px)",e.style.padding="",e.style.margin="");const t=a.querySelector(".main-embedWidgetGenerator-container");t&&(t.style.padding="",t.style.margin="");const n=a.querySelector(".main-trackCreditsModal-originalCredits");n&&(n.style.padding="",n.style.margin="");const o=document.querySelector(".GenericModal__overlay");o&&(o.style.padding="")}d()}return!1})),f.addEventListener("click",(e=>{if(e.preventDefault(),e.stopPropagation(),window.ytvCurrentState&&window.ytvCurrentState.videoList&&window.ytvCurrentState.videoList.length>0){const{videoIndex:e,videoList:t}=window.ytvCurrentState;if(e<t.length-1){const n=e+1,o=t[n];l(o.id.videoId,n,t)}else{if(console.debug("YT-Video: At last video, going back to search"),i&&(i.style.display="flex"),c&&(c.style.display="flex"),s.style.height="calc(100% - 56px)",a){a.style.padding="";const e=a.querySelector(".main-trackCreditsModal-mainSection");e&&(e.style.height="calc(80vh - 60px)",e.style.maxHeight="calc(80vh - 60px)",e.style.padding="",e.style.margin="");const t=a.querySelector(".main-embedWidgetGenerator-container");t&&(t.style.padding="",t.style.margin="");const n=a.querySelector(".main-trackCreditsModal-originalCredits");n&&(n.style.padding="",n.style.margin="");const o=document.querySelector(".GenericModal__overlay");o&&(o.style.padding="")}d()}}else{if(console.debug("YT-Video: Forward button clicked, returning to search"),i&&(i.style.display="flex"),c&&(c.style.display="flex"),s.style.height="calc(100% - 56px)",a){a.style.padding="";const e=a.querySelector(".main-trackCreditsModal-mainSection");e&&(e.style.height="calc(80vh - 60px)",e.style.maxHeight="calc(80vh - 60px)",e.style.padding="",e.style.margin="");const t=a.querySelector(".main-embedWidgetGenerator-container");t&&(t.style.padding="",t.style.margin="");const n=a.querySelector(".main-trackCreditsModal-originalCredits");n&&(n.style.padding="",n.style.margin="");const o=document.querySelector(".GenericModal__overlay");o&&(o.style.padding="")}d()}return!1})),r.appendChild(u),r.appendChild(p),r.appendChild(f),s.appendChild(r),r.addEventListener("click",(e=>{e.stopPropagation()}))},d=()=>{const t=e.value.trim();console.debug("YT-Video: Performing search for:",t),c.useApiKey&&c.apiKey?(async e=>{console.debug("YT-Video: Showing API results for:",e),s.innerHTML='\n        <div style="width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; background: #121212;">\n          <div class="main-loadingSpinner-spinner"></div>\n        </div>\n      ';try{const t=encodeURIComponent(e),n=await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&q=${t}&type=video&maxResults=15&key=${c.apiKey}`),o=await n.json();if(o.error)throw Error(o.error.message||"API Error");if(!o.items||0===o.items.length)return void(s.innerHTML=`\n            <div style="width: 100%; height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; background: #121212; color: white; text-align: center; padding: 20px;">\n              <p>No results found for "${e}"</p>\n              <button onclick="window.open('https://www.youtube.com/results?search_query=${t}', '_blank')" \n                      style="background-color: #282828; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin-top: 16px;">\n                Open Search on YouTube\n              </button>\n            </div>\n          `);window.ytvSearchResults=o.items;const i=document.createElement("div");i.id="ytv-results-container",i.style.width="100%",i.style.height="100%",i.style.overflow="auto",i.style.padding="16px",i.style.background="#121212";const a=document.createElement("div");a.style.display="grid",a.style.gridTemplateColumns="repeat(auto-fill, minmax(300px, 1fr))",a.style.gap="16px",o.items.forEach(((e,t)=>{const n=document.createElement("div");if(n.className="ytv-result",n.dataset.videoId=e.id.videoId,n.dataset.videoIndex=t,n.style.cursor="pointer",n.style.transition="transform 0.2s",n.style.background="#333",n.style.borderRadius="4px",n.style.overflow="hidden",c.showThumbnails){const t=document.createElement("img");t.src=e.snippet.thumbnails.medium.url,t.style.width="100%",t.style.height="180px",t.style.objectFit="cover",n.appendChild(t)}else{const e=document.createElement("div");e.style.width="100%",e.style.height="180px",e.style.background="#222",e.style.display="flex",e.style.justifyContent="center",e.style.alignItems="center",e.innerHTML='\n              <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="#FF0000">\n                <path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"/>\n              </svg>\n            ',n.appendChild(e)}const i=document.createElement("div");i.style.padding="12px";const r=document.createElement("div");r.style.fontWeight="bold",r.style.marginBottom="4px",r.textContent=e.snippet.title,i.appendChild(r);const s=document.createElement("div");s.style.color="#b3b3b3",s.style.fontSize="14px",s.textContent=e.snippet.channelTitle,i.appendChild(s);const d=document.createElement("div");d.style.color="#b3b3b3",d.style.fontSize="12px",d.style.marginTop="4px",d.textContent=new Date(e.snippet.publishedAt).toLocaleDateString(),i.appendChild(d),n.appendChild(i),n.addEventListener("mouseover",(()=>{n.style.transform="scale(1.02)",n.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.2)"})),n.addEventListener("mouseout",(()=>{n.style.transform="scale(1)",n.style.boxShadow="none"})),n.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation();const t=n.dataset.videoId,i=parseInt(n.dataset.videoIndex,10);return console.debug("YT-Video: Result clicked, video ID:",t,"index:",i),l(t,i,o.items),!1})),a.appendChild(n)})),i.appendChild(a),s.innerHTML="",s.appendChild(i),i.addEventListener("click",(e=>{e.stopPropagation()}))}catch(e){console.error("YT-Video: Error fetching search results:",e),s.innerHTML=`\n          <div style="width: 100%; height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; background: #121212; color: white; text-align: center; padding: 20px;">\n            <p>Error: ${e.message||"Failed to fetch search results"}</p>\n            <p style="margin-top: 8px; color: #b3b3b3;">Please check your API key in settings or try again later.</p>\n            <button onclick="window.open('https://www.youtube.com/results?search_query=${o}', '_blank')" \n                    style="background-color: #282828; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin-top: 16px;">\n              Open Search on YouTube\n            </button>\n          </div>\n        `}})(t):(e=>{console.debug("YT-Video: Showing embed results for:",e);const t=encodeURIComponent(e);s.innerHTML=`\n        <iframe \n          style="width: 100%; height: 100%; border: none;" \n          src="https://${n}/embed/videoseries?autoplay=0&rel=0&iv_load_policy=3&fs=1&color=red&hl=en&list=search&playlist=${t}"\n          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"\n          allowfullscreen>\n        </iframe>\n      `,setTimeout((()=>{const e=s.querySelector("iframe");e&&e.addEventListener("load",(()=>{try{e.contentDocument.addEventListener("click",(e=>{e.stopPropagation()}))}catch(e){console.debug("YT-Video: Could not add event listeners to iframe content due to cross-origin restrictions")}}))}),100)})(t)};t&&t.addEventListener("click",(e=>(e.preventDefault(),e.stopPropagation(),d(),!1))),e&&(e.addEventListener("keypress",(e=>{if("Enter"===e.key)return e.preventDefault(),e.stopPropagation(),d(),!1})),e.addEventListener("click",(e=>{e.stopPropagation()}))),i&&i.addEventListener("click",(t=>{t.preventDefault(),t.stopPropagation();const n=e.value.trim();return window.open("https://www.youtube.com/results?search_query="+encodeURIComponent(n),"_blank"),!1})),r&&r.addEventListener("click",(e=>(e.preventDefault(),e.stopPropagation(),window.ytvCurrentPopup&&(window.ytvCurrentPopup.hide(),window.ytvCurrentPopup=null),setTimeout((()=>{a()}),100),!1))),s&&s.addEventListener("click",(e=>{e.stopPropagation()})),d()}),100)}function l(){const e=function(){console.debug("YT-Video: Getting current track info");try{if(Spicetify.Player&&Spicetify.Player.data){const e=Spicetify.Player.data;if(e.track&&e.track.metadata){const t=e.track.metadata;return console.debug("YT-Video: Found track info using Player.data"),{name:t.title,artist:t.artist_name,album:t.album_title}}}try{if(Spicetify.Player&&"function"==typeof Spicetify.Player.getTrackInfo){const e=Spicetify.Player.getTrackInfo();if(e)return console.debug("YT-Video: Found track info using Player.getTrackInfo()"),{name:e.track,artist:e.artist,album:e.album}}}catch(e){console.debug("YT-Video: Error getting track info from Player.getTrackInfo():",e)}const e=document.querySelector(".main-nowPlayingWidget-nowPlaying .main-trackInfo-name"),t=document.querySelector(".main-nowPlayingWidget-nowPlaying .main-trackInfo-artists");if(e&&t)return console.debug("YT-Video: Found track info using DOM elements"),{name:e.textContent,artist:t.textContent,album:""};const n=document.querySelector("[data-testid='now-playing-widget'] .main-trackInfo-name"),o=document.querySelector("[data-testid='now-playing-widget'] .main-trackInfo-artists");if(n&&o)return console.debug("YT-Video: Found track info using alternative DOM selectors"),{name:n.textContent,artist:o.textContent,album:""};const i=document.title;if(i&&i.includes(" - ")&&!i.startsWith("Spotify")){const e=i.split(" - ");if(e.length>=2)return console.debug("YT-Video: Found track info using document title"),{name:e[0],artist:e[1].replace(" • Spotify",""),album:""}}return console.error("YT-Video: Could not find track info using any method"),null}catch(e){return console.error("YT-Video: Error getting current track info:",e),null}}();e?s(e):Spicetify.showNotification("No track information available")}async function d(){if(console.debug("YT-Video: Adding YouTube button"),document.querySelector("."+t))return console.debug("YT-Video: Button already exists"),!0;const n=function(){const n=document.createElement("button");return n.classList.add(t),n.setAttribute("title",e),n.setAttribute("aria-label",e),n.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="currentColor">\n  <path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"/>\n</svg>',n.style.backgroundColor="transparent",n.style.border="none",n.style.color="#FF0000",n.style.cursor="pointer",n.style.padding="0",n.style.width="32px",n.style.height="32px",n.style.display="flex",n.style.alignItems="center",n.style.justifyContent="center",n.style.opacity="0.7",n.style.transition="opacity 0.2s ease-in-out",n.addEventListener("mouseover",(()=>{n.style.opacity="1"})),n.addEventListener("mouseout",(()=>{n.style.opacity="0.7"})),n.addEventListener("click",l),n}(),o=[".main-trackInfo-container",".main-nowPlayingBar-extraControls",".main-nowPlayingBar-right",".main-nowPlayingWidget-nowPlaying"];for(const e of o){const t=await r(e);if(t)return console.debug("YT-Video: Adding button to "+e),t.appendChild(n),!0}return console.debug("YT-Video: No suitable container found, adding to body"),n.style.position="fixed",n.style.bottom="80px",n.style.right="16px",n.style.zIndex="9999",document.body.appendChild(n),!0}(async e=>{for(;!e();)await new Promise((e=>setTimeout(e,120)));await async function(){console.debug("YT-Video: Initializing"),function(){try{const e=JSON.parse(localStorage.getItem(o));e?(c={...i,...e},console.debug("YT-Video: Loaded settings:",c)):console.debug("YT-Video: No saved settings found, using defaults")}catch(e){console.error("YT-Video: Error loading settings:",e),c={...i}}}(),await d(),Spicetify.ContextMenu?(new Spicetify.ContextMenu.Item("Play video",(async e=>{if(!e||!e.length)return void console.error("YT-Video: No URIs provided to context menu handler");Spicetify.Player.isPlaying()&&(console.debug("YT-Video: Pausing playback"),Spicetify.Player.pause());const t=e[0];console.debug("YT-Video: Context menu item clicked for URI:",t);const n=await async function(e){console.debug("YT-Video: Getting track info from URI:",e);try{if(e.includes("spotify:track:")){const t=e.split("spotify:track:")[1],n=await Spicetify.CosmosAsync.get("https://api.spotify.com/v1/tracks/"+t);if(n&&n.name)return console.debug("YT-Video: Found track info from track URI"),{name:n.name,artist:n.artists?.[0]?.name||"",album:n.album?.name||""}}else if(e.includes("spotify:album:")){const t=e.split("spotify:album:")[1],n=await Spicetify.CosmosAsync.get("https://api.spotify.com/v1/albums/"+t);if(n&&n.name)return console.debug("YT-Video: Found album info from album URI"),{name:n.name,artist:n.artists?.[0]?.name||"",album:n.name}}else if(e.includes("spotify:artist:")){const t=e.split("spotify:artist:")[1],n=await Spicetify.CosmosAsync.get("https://api.spotify.com/v1/artists/"+t);if(n&&n.name)return console.debug("YT-Video: Found artist info from artist URI"),{name:"",artist:n.name,album:""}}return console.error("YT-Video: Could not get track info from URI:",e),null}catch(e){return console.error("YT-Video: Error getting track info from URI:",e),null}}(t);s(n)}),(e=>{if(!e||!e.length)return!1;const t=e[0];return t.includes("spotify:track:")||t.includes("spotify:album:")||t.includes("spotify:artist:")}),'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="#FF0000" style="margin-right: 4px; vertical-align: -3px;">\n  <path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"/>\n</svg>').register(),console.debug("YT-Video: Added context menu items")):console.error("YT-Video: Spicetify.ContextMenu is not available"),Spicetify.Player.addEventListener("songchange",(async()=>{console.debug("YT-Video: Song changed, updating button"),await d()})),Spicetify.Platform.History.listen((async()=>{console.debug("YT-Video: App navigation detected, updating button"),await d()})),console.debug("YT-Video: Initialization complete")}()})((()=>{const e=Spicetify&&Spicetify.Platform&&Spicetify.Platform.FeedbackAPI&&"complete"===document.readyState;return e&&console.debug("YT-Video: Spicetify is ready"),e}))})();