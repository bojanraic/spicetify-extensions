(()=>{const t="Private session",n="Persistent Privacy",e=100,o="div.main-topBar-topbarContentRight > button.main-userWidget-box";let i=!1,u=null,c=!1,r=0,s=!1,a=!1,f=!1,m=null;async function l(){for(let n=0;n<2;n++){const n=document.querySelectorAll("button.main-actionButtons-button");for(const e of n)if(e.textContent.includes(t))return e;await new Promise((t=>setTimeout(t,e)))}return null}function w(){localStorage.setItem("private-session-persistent-mode",i.toString())}async function d(){const t=await l();return a=!!t,a}function p(){if(m&&(clearTimeout(m),m=null),document.querySelector("ul.main-contextMenu-menu")){const t=document.querySelector(o);t&&(t.click(),m=setTimeout((()=>{document.querySelector("ul.main-contextMenu-menu")&&t.click(),m=null}),150))}}async function y(n=!0){if(c)return!1;const i=Date.now();if(i-r<500)return!1;try{if(await d())return!0;if(!n)return!1;if(c=!0,r=i,p(),await new Promise((t=>setTimeout(t,150))),!await async function(t){const n=await async function(t){for(let n=0;n<3;n++){{const n=document.querySelector(t);if(n)return n}await new Promise((t=>setTimeout(t,e)))}return null}(t);return n?(n.click(),n):null}(o))return c=!1,!1;await new Promise((t=>setTimeout(t,200)));const u=await async function(t){for(let n=0;n<3;n++){const n=document.querySelectorAll("ul > li > button.main-contextMenu-menuItemButton[role='menuitemcheckbox']");if(n.length>0)for(const e of n){const n=e.querySelector("span");if(n&&n.textContent.trim()===t)return e}await new Promise((t=>setTimeout(t,e)))}return null}(t);return u?(await async function(t){return!!t.querySelector("svg")}(u)?a=!0:(u.click(),a=!0,await new Promise((t=>setTimeout(t,e)))),p(),c=!1,!0):(p(),c=!1,!1)}catch(t){return p(),c=!1,!1}}function g(){i=!0,w(),u||(u=()=>{s||(s=!0,setTimeout((async()=>{s=!1,!await d()&&i&&await y(!0)}),500))},window.addEventListener("focus",u))}function v(){const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("role","img"),t.setAttribute("height","20"),t.setAttribute("width","20"),t.setAttribute("aria-hidden","true"),t.setAttribute("viewBox","0 0 20 20"),t.style.marginLeft="8px",t.style.verticalAlign="middle";const n=document.createElementNS("http://www.w3.org/2000/svg","circle");n.setAttribute("cx","10"),n.setAttribute("cy","10"),n.setAttribute("r","9"),n.setAttribute("fill","#1DB954");const e=document.createElementNS("http://www.w3.org/2000/svg","path");return e.setAttribute("d","M8.5 13.5l-3.5-3.5 1.5-1.5 2 2 4.5-4.5 1.5 1.5z"),e.setAttribute("fill","#FFFFFF"),t.appendChild(n),t.appendChild(e),t}function h(t,n){const e=Array.from(t.querySelectorAll("span"));for(const t of e)if(t.textContent===n)return t.closest("button");return null}function b(){const e=document.querySelector("ul.main-contextMenu-menu");if(!e)return;const o=Array.from(e.querySelectorAll("span"));for(const t of o)if(t.textContent===n){const n=t.closest("button");if(n){n.setAttribute("aria-checked",i?"true":"false");const t=n.querySelector("svg");i?t||n.appendChild(v()):!i&&t&&t.remove()}return}!function(e){const o=Array.from(e.querySelectorAll("span")).find((n=>n.textContent===t));if(!o)return;const c=o.closest("li");if(!c)return;const r=c.cloneNode(!0),s=r.querySelector("span");s&&(s.textContent=n);const a=r.querySelector("button");if(a){a.setAttribute("aria-checked",i?"true":"false"),a.querySelectorAll("svg").forEach((t=>t.remove())),i&&a.appendChild(v()),a.replaceWith(a.cloneNode(!0));const t=r.querySelector("button");t.addEventListener("click",(()=>{i?(i=!1,w(),u&&(window.removeEventListener("focus",u),u=null)):g(),t.setAttribute("aria-checked",i?"true":"false");const n=t.querySelector("svg");i&&!n?t.appendChild(v()):!i&&n&&n.remove()}))}c.after(r)}(e)}(async n=>{for(;!n();)await new Promise((t=>setTimeout(t,e)));await async function(){!function(){const t=localStorage.getItem("private-session-persistent-mode");i="true"===t}(),new MutationObserver((n=>{const e=Date.now();if(!(e-r<500))for(const o of n)if(o.addedNodes.length>0)for(const n of o.addedNodes)if("DIV"===n.nodeName&&n.querySelector&&n.querySelector("ul.main-contextMenu-menu"))return r=e,void setTimeout((()=>{i?l().then((n=>{if(!n){const n=document.querySelector("ul.main-contextMenu-menu");if(n){const e=h(n,t);e&&!e.querySelector("svg")&&e.click()}}b()})):b()}),150)})).observe(document.body,{childList:!0,subtree:!0}),await d(),f=!0,i&&g(),await new Promise((t=>setTimeout(t,800))),a||await y(!0)}()})((()=>Spicetify&&Spicetify.Platform&&Spicetify.Platform.FeedbackAPI&&"complete"===document.readyState))})();