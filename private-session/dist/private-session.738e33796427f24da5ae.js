(()=>{const t="Private session",n="Persistent Privacy",e=100,o="div.main-topBar-topbarContentRight > button.main-userWidget-box";let i=!1,c=null,u=!1,s=0,r=!1,a=!1,f=!1,m=null;async function l(){for(let n=0;n<2;n++){const n=document.querySelectorAll("button.main-actionButtons-button");for(const e of n)if(e.textContent.includes(t))return e;await new Promise((t=>setTimeout(t,e)))}return null}function w(){localStorage.setItem("private-session-persistent-mode",i.toString())}async function d(){const t=await l();return a=!!t,a}function p(){if(m&&(clearTimeout(m),m=null),document.querySelector("ul.main-contextMenu-menu")){const t=document.querySelector(o);t&&(t.click(),m=setTimeout((()=>{document.querySelector("ul.main-contextMenu-menu")&&t.click(),m=null}),150))}}async function y(n=!0){if(u)return!1;const i=Date.now();if(i-s<500)return!1;try{if(await d())return!0;if(!n)return!1;if(u=!0,s=i,p(),await new Promise((t=>setTimeout(t,150))),!await async function(t){const n=await async function(t){for(let n=0;n<3;n++){{const n=document.querySelector(t);if(n)return n}await new Promise((t=>setTimeout(t,e)))}return null}(t);return n?(n.click(),n):null}(o))return u=!1,!1;await new Promise((t=>setTimeout(t,200)));const c=await async function(t){for(let n=0;n<3;n++){const n=document.querySelectorAll("ul > li > button.main-contextMenu-menuItemButton[role='menuitemcheckbox']");if(n.length>0)for(const e of n){const n=e.querySelector("span");if(n&&n.textContent.trim()===t)return e}await new Promise((t=>setTimeout(t,e)))}return null}(t);return c?(await async function(t){return!!t.querySelector("svg")}(c)?a=!0:(c.click(),a=!0,await new Promise((t=>setTimeout(t,e)))),p(),u=!1,!0):(p(),u=!1,!1)}catch(t){return p(),u=!1,!1}}function g(){i=!0,w(),c||(c=()=>{r||(r=!0,setTimeout((async()=>{r=!1,!await d()&&i&&await y(!0)}),500))},window.addEventListener("focus",c))}function v(){const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("role","img"),t.setAttribute("height","20"),t.setAttribute("width","20"),t.setAttribute("aria-hidden","true"),t.setAttribute("viewBox","0 0 20 20"),t.style.marginLeft="8px",t.style.verticalAlign="middle";const n=document.createElementNS("http://www.w3.org/2000/svg","circle");n.setAttribute("cx","10"),n.setAttribute("cy","10"),n.setAttribute("r","9"),n.setAttribute("fill","#1DB954");const e=document.createElementNS("http://www.w3.org/2000/svg","path");return e.setAttribute("d","M8.5 13.5l-3.5-3.5 1.5-1.5 2 2 4.5-4.5 1.5 1.5z"),e.setAttribute("fill","#FFFFFF"),t.appendChild(n),t.appendChild(e),t}function h(){i?(i=!1,w(),c&&(window.removeEventListener("focus",c),c=null)):g()}function T(){const e=document.querySelector("ul.main-contextMenu-menu");if(!e)return;const o=Array.from(e.querySelectorAll("span"));for(const t of o)if(t.textContent===n){const n=t.closest("button");if(n){n.setAttribute("aria-checked",i?"true":"false");const t=n.querySelector("svg");i?t||n.appendChild(v()):!i&&t&&t.remove()}return}!function(e){const o=Array.from(e.querySelectorAll("span")).find((n=>n.textContent===t));if(!o)return;const c=o.closest("li");if(!c)return;const u=c.cloneNode(!0),s=u.querySelector("span");s&&(s.textContent=n);const r=u.querySelector("button");if(r){r.setAttribute("aria-checked",i?"true":"false"),r.querySelectorAll("svg").forEach((t=>t.remove())),i&&r.appendChild(v()),r.replaceWith(r.cloneNode(!0));const t=u.querySelector("button");t.addEventListener("click",(()=>{h(),t.setAttribute("aria-checked",i?"true":"false");const n=t.querySelector("svg");i&&!n?t.appendChild(v()):!i&&n&&n.remove()}))}c.after(u)}(e)}function b(t,n){const e=Array.from(t.querySelectorAll("span"));for(const t of e)if(t.textContent===n)return t.closest("button");return null}(async c=>{for(;!c();)await new Promise((t=>setTimeout(t,e)));await async function(){!function(){const t=localStorage.getItem("private-session-persistent-mode");i="true"===t}();let c=!1;for(;Spicetify&&(!Spicetify.Menu||!Spicetify.Platform);)await new Promise((t=>setTimeout(t,e)));if(Spicetify&&Spicetify.Menu)try{new Spicetify.Menu.Item(n,i,(t=>{h(),t.setState(i)})).register(),c=!0}catch(t){}c||(function(){const n=document.querySelector(o);n&&n.addEventListener("click",(()=>{setTimeout((()=>{const n=document.querySelector("ul.main-contextMenu-menu");n&&(i&&l().then((e=>{if(!e){const e=b(n,t);e&&!e.querySelector("svg")&&e.click()}})),T())}),100)}))}(),new MutationObserver((n=>{const e=Date.now();if(!(e-s<500))for(const o of n)if(o.addedNodes.length>0)for(const n of o.addedNodes)if("DIV"===n.nodeName&&n.querySelector&&n.querySelector("ul.main-contextMenu-menu"))return s=e,void setTimeout((()=>{i?l().then((n=>{if(!n){const n=document.querySelector("ul.main-contextMenu-menu");if(n){const e=b(n,t);e&&!e.querySelector("svg")&&e.click()}}T()})):T()}),150)})).observe(document.body,{childList:!0,subtree:!0})),await d(),f=!0,i&&g(),await new Promise((t=>setTimeout(t,800))),a||await y(!0)}()})((()=>Spicetify&&Spicetify.Platform&&Spicetify.Platform.FeedbackAPI&&"complete"===document.readyState))})();