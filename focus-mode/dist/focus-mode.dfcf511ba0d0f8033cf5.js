(()=>{let e=null,n=null;const t="focus-mode-active",i="focus-mode-controls-visible",o="focus-mode-",r=`${o}album-art`,a=`${o}player-controls`,l=`${o}track-info`,c=`${o}react-root`,s={background:"rgba(255, 255, 255, 0.1)",color:"white",border:"none",borderRadius:"50%",padding:"8px",minWidth:"32px",minHeight:"32px",width:"32px",height:"32px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer"},u="body .Root__top-bar, body .Root__nav-bar, body .Root__main-view, body .Root__now-playing-bar, body .Root__right-sidebar",d=".main-nowPlayingView-section, .main-trackInfo-container, .main-trackList-trackList";let y=!1,p=null,m=null,f=!1,g=null,h=null,v=null,b=!1,S=!1,x=!1,w=null,k=null,E=null,P=null,L=null,C=null,$=null;function I(){const e=Spicetify.Player.data?.item;if(!e)return p=null,m=null,void(S=!1);const n=e.metadata;if(n){Spicetify.Platform&&Spicetify.Platform.PlayerAPI,p=n;const e=n?.image_xlarge_url||n?.image_large_url||n?.image_url;m=e||null,async function(){try{if(!Spicetify.Platform||!Spicetify.Platform.PlayerAPI)return!1;const e=Spicetify.Player.data?.item;if(!e||!e.uri)return!1;if(Spicetify.Player.getLyrics)try{const e=await Spicetify.Player.getLyrics();if(e&&e.lines&&e.lines.length>0)return!0}catch(e){}if(Spicetify.Platform.PlayerAPI.getPlayerState)try{const e=await Spicetify.Platform.PlayerAPI.getPlayerState();if(e?.track?.hasLyrics||e?.track?.lyrics)return!0}catch(e){}if("true"===p?.has_lyrics||"true"===p?.lyrics||p?.lyrics_id)return!0}catch(e){return!1}return!1}().then((e=>{S=e,_()})).catch((e=>{S=!1,_()}))}else p={uri:e.uri},m=null,S=!1}function _(){if(y&&v&&e&&n&&$)try{n.render(e.createElement($,{trackData:p,albumArtUrl:m,controlsVisible:f}),v)}catch(e){Spicetify.showNotification("Error rendering Focus Mode UI. Check console.",!0)}}function M(){y&&(f||(f=!0,document.body.classList.add(i)),g&&clearTimeout(g),g=setTimeout((()=>{f=!1,document.body.classList.remove(i),g=null}),3e3))}function A(e){if(y&&y)switch(e.key.toLowerCase()){case"escape":N();break;case" ":Spicetify.Player.togglePlay(),e.preventDefault();break;case"arrowleft":Spicetify.Player.back(),e.preventDefault();break;case"arrowright":Spicetify.Player.next(),e.preventDefault();break;case"arrowup":const n=Spicetify.Player.getVolume(),t=Math.min(1,n+.05);Spicetify.Player.setVolume(t),P&&L&&(P(t),L(t)),e.preventDefault();break;case"arrowdown":const i=Spicetify.Player.getVolume(),o=Math.max(0,i-.05);Spicetify.Player.setVolume(o),P&&L&&(P(o),L(o)),e.preventDefault();break;case"+":case"=":B(.05),e.preventDefault();break;case"-":B(-.05),e.preventDefault();break;case"l":!async function(){if(!S)return void Spicetify.showNotification("Lyrics not available for this track.");x=!x,x?(E=Spicetify.Platform.History.location.pathname,"/lyrics-plus"!==E&&Spicetify.Platform.History.push("/lyrics-plus"),setTimeout((()=>{window.addEventListener("lyrics-plus-update",V),window.dispatchEvent(new Event("fad-request")),document.body.classList.add("focus-mode-lyrics-active"),w=null,k=-1,_()}),200)):(window.removeEventListener("lyrics-plus-update",V),E&&"/lyrics-plus"!==E&&Spicetify.Platform.History.push(E),E=null,document.body.classList.remove("focus-mode-lyrics-active"),w=null,k=-1,Spicetify.Player.removeEventListener("onprogress",z),_())}(),e.preventDefault()}}function B(e){const n=document.getElementById(r);if(n){const t=parseFloat(n.style.opacity||.25),i=Math.max(0,Math.min(1,t+e));n.style.opacity=i,C&&C(i)}}function D(e){!y||e.target.closest(`#${a}`)||e.target.closest(`#${l}`)||!h||h.element.contains(e.target)||N()}function T(){setTimeout((()=>{I(),y&&_()}),100)}function V(e){}function z(e){}function R(e){if(isNaN(e)||e<0)return"0:00";const n=Math.floor(e/1e3),t=n%60;return`${Math.floor(n/60)}:${t<10?"0":""}${t}`}async function H(){if(y)return;if(b=!!document.fullscreenElement,!b&&document.documentElement.requestFullscreen)try{await document.documentElement.requestFullscreen()}catch(e){}const e="focus-mode-styles";if(!document.getElementById(e)){const n=document.createElement("style");n.id=e,n.textContent=`\n    /* Hide original UI when focus mode active */\n    body.${t} ${u} {\n      opacity: 0 !important;\n      visibility: hidden !important;\n      pointer-events: none !important;\n      transition: opacity 500ms ease, visibility 500ms ease;\n    }\n    body.${t} ${d} {\n      display: none !important;\n    }\n    body.${t} { \n      overflow: hidden !important; \n      /* Cursor hidden globally removed */\n    }\n\n    /* Focus Mode Root Container - Initially hidden */\n    #${c} {\n      display: none; /* Hidden by default */\n      position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;\n      z-index: 9998; \n      background-color: #000; \n      pointer-events: none; /* Initially no pointer events */\n      cursor: none; /* Hide cursor only on the background element */\n    }\n\n    /* Show and enable root container only when active */\n    body.${t} #${c} {\n        display: block;\n        pointer-events: auto; /* Enable clicks on background */\n    }\n\n    /* Album Art Styling (within React component) */\n    #${r} {\n      display: block;\n      position: absolute;\n      top: 0; left: 0;\n      width: 100%; height: 100%;\n      object-fit: contain; \n      margin: 0; padding: 0; border: none;\n    }\n\n    /* Controls Container Styling (within React component) */\n    #${a} {\n      position: absolute; \n      bottom: 0; left: 0;\n      width: 100%;\n      z-index: 10000; \n      background: rgba(0, 0, 0, 0.7); \n      padding: 16px 0; \n      pointer-events: auto; \n      opacity: 0; \n      transition: opacity 500ms ease !important;\n      display: flex; \n      justify-content: center;\n      cursor: auto !important;\n    }\n    body.${t}.${i} #${a} {\n      opacity: 1 !important;\n    }\n\n    /* Track Info Container Styling (within React component) */\n    #${l} {\n      position: absolute; \n      top: 0; left: 0;\n      width: 100%;\n      text-align: center; \n      z-index: 10000; \n      pointer-events: none; /* Let mouse events pass through by default */\n      opacity: 0; \n      transition: opacity 500ms ease !important;\n      background: rgba(0, 0, 0, 0.7); \n      padding: 16px; \n      color: white; \n      cursor: none; /* Hide cursor by default on this layer */\n    }\n    /* Allow pointer events on the icon when it's shown */\n    #${l} .track-title span[title="Toggle Lyrics (L)"] {\n      pointer-events: auto;\n      /* Ensure the SVG icon inherits text color */\n      fill: currentColor;\n      width: 1em;\n      height: 1em;\n      display: inline-block; /* Explicitly set display */\n      cursor: pointer; /* Show pointer specifically on the icon */\n    }\n    body.${t}.${i} #${l} {\n      opacity: 1 !important;\n      cursor: auto !important; /* Show cursor when overlay is visible */\n    }\n    #${l} .track-title {\n      font-size: 1.2em; font-weight: bold;\n    }\n    #${l} .track-artist {\n      font-size: 1em; opacity: 0.8;\n    }\n    #${l} .track-album {\n      font-size: 0.9em; opacity: 0.7; font-style: italic;\n    }\n    \n    /* Ensure cloned controls inherit necessary styles */\n    #${a} .main-nowPlayingBar-center {\n        /* Add specific overrides if needed */\n    }\n    \n    /* --- Lyrics Overlay Styles --- */\n    #fad-lyrics-plus-container.lyrics-overlay-container {\n      position: absolute;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      z-index: 9999; /* Above art (9998), below controls/info (10000) */\n      background: rgba(0, 0, 0, 0.7); /* Semi-transparent background */\n      overflow-y: auto; /* Allow scrolling if lyrics-plus content overflows */\n      pointer-events: none; /* Allow clicks through to bg/art by default */\n      opacity: 0; /* Hidden by default */\n      transition: opacity 500ms ease;\n      \n      /* Assume lyrics-plus provides its own text styling (color, size, alignment) */\n      /* We only provide the container */\n    }\n    \n    /* Enable pointer events if lyrics-plus content needs interaction */\n    /* This might need adjustment depending on lyrics-plus behavior */\n    #fad-lyrics-plus-container.lyrics-overlay-container > * {\n      pointer-events: auto; \n    }\n    \n    /* Show the overlay when lyrics are active */\n    body.focus-mode-lyrics-active #fad-lyrics-plus-container.lyrics-overlay-container {\n      opacity: 1;\n    }\n    \n    /* Ensure Track Info and Player Controls are definitely above the lyrics */\n    #${l} { z-index: 10000; }\n    #${a} { z-index: 10000; }\n    \n    /* Hide lyrics-plus config button container when lyrics overlay is active */\n    body.focus-mode-lyrics-active #fad-lyrics-plus-container .lyrics-config-button-container {\n      display: none !important; /* Hide the element */\n    }\n    \n    /* --- Progress Bar Styling --- */\n    #focus-mode-progress-bar {\n      -webkit-appearance: none; \n      appearance: none;\n      flex-grow: 1; \n      height: 4px; \n      border-radius: 2px;\n      cursor: pointer;\n      outline: none;\n      background: linear-gradient(to right, \n          #fff var(--progress-percent, 0%), \n          rgba(255, 255, 255, 0.3) var(--progress-percent, 0%)\n      );\n    }\n    \n    /* Style the thumb (shared by all range inputs) */\n    #focus-mode-progress-bar::-webkit-slider-thumb,\n    .focus-mode-volume-slider::-webkit-slider-thumb,\n    .focus-mode-dim-slider::-webkit-slider-thumb {\n      -webkit-appearance: none; \n      appearance: none;\n      width: 12px; \n      height: 12px; \n      background: #fff; \n      border-radius: 50%;\n      cursor: pointer; \n    }\n    \n    #focus-mode-progress-bar::-moz-range-thumb,\n    .focus-mode-volume-slider::-moz-range-thumb,\n    .focus-mode-dim-slider::-moz-range-thumb {\n      width: 12px; \n      height: 12px; \n      background: #fff;\n      border-radius: 50%;\n      border: none;\n      cursor: pointer;\n    }\n    \n    /* --- Volume Slider Styling --- */\n    .focus-mode-volume-slider {\n      -webkit-appearance: none; \n      appearance: none;\n      flex-grow: 1; \n      height: 4px; \n      border-radius: 2px;\n      cursor: pointer;\n      outline: none;\n      /* Use linear gradient for fill effect, same as progress bar */\n      background: linear-gradient(to right, \n          #fff var(--volume-percent, 0%), /* White fill */\n          rgba(255, 255, 255, 0.3) var(--volume-percent, 0%) /* Dim background */\n      );\n    }\n    \n    /* --- Dim Slider Styling --- */\n    .focus-mode-dim-slider {\n       -webkit-appearance: none; \n      appearance: none;\n      flex-grow: 1; \n      height: 4px; \n      border-radius: 2px;\n      cursor: pointer;\n      outline: none;\n      /* Apply fill effect using --dim-percent variable */\n      background: linear-gradient(to right, \n          #fff var(--dim-percent, 25%), /* White fill, default 25% */\n          rgba(255, 255, 255, 0.3) var(--dim-percent, 25%) /* Dim background */\n      ); \n    }\n    \n  `,document.head.appendChild(n)}y=!0,h&&(h.active=!0),document.body.classList.add(t),I(),v||(v=document.createElement("div"),v.id=c,document.body.appendChild(v)),f=!1,document.body.classList.remove(i),_(),document.addEventListener("mousemove",M),document.addEventListener("keydown",A),document.addEventListener("click",D),M()}function N(){if(!y)return f=!1,void(h&&(h.active=!1));if(!b&&document.fullscreenElement&&document.exitFullscreen)try{document.exitFullscreen()}catch(e){}document.removeEventListener("mousemove",M),document.removeEventListener("keydown",A),document.removeEventListener("click",D),g&&(clearTimeout(g),g=null),function(){if(v&&n)try{n.unmountComponentAtNode(v)}catch(e){}}(),document.body.classList.remove(t),document.body.classList.remove(i);try{document.querySelectorAll(u).forEach((e=>{e instanceof HTMLElement&&(e.style.opacity="1",e.style.visibility="visible",e.style.pointerEvents="auto",e.style.display="")}))}catch(e){}y=!1,f=!1,h&&(h.active=!1),v&&(v.remove(),v=null);const e=document.getElementById("focus-mode-styles");e&&e.remove(),p=null,m=null}!function t(){for(;!(Spicetify?.React&&Spicetify?.ReactDOM&&Spicetify?.Player?.addEventListener&&Spicetify?.Playbar?.Button&&Spicetify?.showNotification);)return setTimeout(t,100);e=Spicetify.React,n=Spicetify.ReactDOM;const i=({icon:n,onClick:t,className:i="",style:o={}})=>{const r=Spicetify.SVGIcons[n];return r?e.createElement("button",{className:`focus-mode-control-button ${i}`,onClick:t,style:{...s,...o}},r?e.createElement("svg",{width:16,height:16,viewBox:"0 0 16 16",fill:"currentColor",dangerouslySetInnerHTML:{__html:r}}):e.createElement("svg",{width:16,height:16,viewBox:"0 0 16 16",fill:"rgba(255, 255, 255, 0.5)"},e.createElement("path",{d:"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8z"}))):null},c=()=>{const[n,t]=e.useState(Spicetify.Player.isPlaying()),[o,a]=e.useState(Spicetify.Player.getVolume()),[l,c]=e.useState(o),[s,u]=e.useState(.25),[d,y]=e.useState(0),[p,m]=e.useState(Spicetify.Player.data?.item?.duration?.milliseconds||Spicetify.Player.getDuration()||0),[f,g]=e.useState("0:00"),[h,v]=e.useState(R(p)),[b,S]=e.useState(!1),x=e.useRef(null),w=e.useRef(null),k=(e,n,t)=>{e&&e.style.setProperty(n,100*t+"%")};e.useEffect((()=>{k(x.current,"--volume-percent",l)}),[l]),e.useEffect((()=>{k(w.current,"--dim-percent",s)}),[s]),e.useEffect((()=>(P=a,L=c,C=u,()=>{P=null,L=null,C=null})),[]),e.useEffect((()=>{const e=({data:e})=>{a(e),c(e)};Spicetify.Player.addEventListener("onvolumechange",e);const n=Spicetify.Player.getVolume();return a(n),c(n),()=>{Spicetify.Player.removeEventListener("onvolumechange",e)}}),[]),e.useEffect((()=>{const e=()=>t(Spicetify.Player.isPlaying());return Spicetify.Player.addEventListener("onplaypause",e),e(),()=>{Spicetify.Player.removeEventListener("onplaypause",e)}}),[]),e.useEffect((()=>{const e=e=>{if(!e||!e.data)return;const n=e.data,t=p||Spicetify.Player.getDuration();if(t>0){const e=Math.min(1,Math.max(0,n/t));y(e),g(R(n))}},n=()=>{setTimeout((()=>{const e=Spicetify.Player.data?.item?.duration?.milliseconds||Spicetify.Player.getDuration()||0;m(e),v(R(e)),y(0),g("0:00")}),100)},t=Spicetify.Player.data?.item?.duration?.milliseconds||Spicetify.Player.getDuration()||0;m(t),v(R(t));const i=Spicetify.Player.getProgress();if(t>0){const e=Math.min(1,Math.max(0,i/t));y(e),g(R(i))}return Spicetify.Player.addEventListener("onprogress",e),Spicetify.Player.addEventListener("songchange",n),()=>{Spicetify.Player.removeEventListener("onprogress",e),Spicetify.Player.removeEventListener("songchange",n)}}),[]),e.useEffect((()=>{const e=document.getElementById(r);e&&(e.style.opacity=s)}),[]);let E=h;if(b){const e=d*p;E="-"+R(Math.max(0,p-e))}return e.createElement("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",width:"100%",gap:"10px"}},e.createElement("div",{style:{display:"flex",alignItems:"center",width:"80%",maxWidth:"500px",gap:"8px"}},e.createElement("span",{id:"focus-mode-current-time",style:{fontSize:"0.8em",minWidth:"35px",textAlign:"right"}},f),e.createElement("input",{type:"range",min:0,max:1,step:.001,value:d,onChange:e=>{const n=parseFloat(e.target.value);y(n);const t=n*p;g(R(t)),isFinite(t)&&Spicetify.Player.seek(t)},id:"focus-mode-progress-bar",style:{flexGrow:1,cursor:"pointer",height:"4px","--progress-percent":100*d+"%"}}),e.createElement("span",{id:"focus-mode-duration",style:{fontSize:"0.8em",minWidth:"35px",textAlign:"left",cursor:"pointer",userSelect:"none"},onClick:()=>{S((e=>!e))}},E)),e.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"15px",width:"100%",padding:"0 20px"}},e.createElement("div",{style:{display:"flex",alignItems:"center",gap:"5px",flexBasis:"150px"}},e.createElement("svg",{width:16,height:16,viewBox:"0 0 16 16",fill:"currentColor",dangerouslySetInnerHTML:{__html:Spicetify.SVGIcons.brightness||Spicetify.SVGIcons.search}}),e.createElement("input",{type:"range",min:0,max:1,step:.01,value:s,onChange:e=>{const n=parseFloat(e.target.value);u(n);const t=document.getElementById(r);t&&(t.style.opacity=n)},ref:w,style:{flexGrow:1,cursor:"pointer"},className:"focus-mode-dim-slider"})),e.createElement(i,{icon:"skip-back",onClick:Spicetify.Player.back}),e.createElement(i,{icon:n?"pause":"play",onClick:Spicetify.Player.togglePlay,style:{transform:"scale(1.1)"}}),e.createElement(i,{icon:"skip-forward",onClick:Spicetify.Player.next}),e.createElement("div",{style:{display:"flex",alignItems:"center",gap:"5px",flexBasis:"150px"}},e.createElement("svg",{width:16,height:16,viewBox:"0 0 16 16",fill:"currentColor",dangerouslySetInnerHTML:{__html:o>.5?Spicetify.SVGIcons.volume:o>0?Spicetify.SVGIcons["volume-low"]:Spicetify.SVGIcons["volume-off"]}}),e.createElement("input",{type:"range",min:0,max:1,step:.01,value:l,onChange:e=>{const n=parseFloat(e.target.value);c(n),Spicetify.Player.setVolume(n)},ref:x,className:"focus-mode-volume-slider"}))))};$=({trackData:n,albumArtUrl:t,controlsVisible:i})=>{const s=(u=t)&&u.startsWith("spotify:image:")?`https://i.scdn.co/image/${u.substring(14)}`:null;var u;const d=n?.title||"Loading...",y=n?.artist_name||"",p=n?.album_title||"";return e.createElement("div",{id:o+"content"},s&&e.createElement("img",{id:r,src:s,alt:"Album Art"}),e.createElement("div",{id:"fad-lyrics-plus-container",className:"lyrics-overlay-container"}),e.createElement("div",{id:l},e.createElement("div",{className:"track-title"},d),e.createElement("div",{className:"track-artist"},y),p&&e.createElement("div",{className:"track-album"},p)),e.createElement("div",{id:a},e.createElement(c,null)))},N(),p=null,m=null,S=!1,x=!1,function(){if(!Spicetify?.Playbar?.Button)return;h=new Spicetify.Playbar.Button("Focus Mode",'\n    <span class="e-9800-button__icon-wrapper" aria-hidden="true">\n      <svg \n        role="img"\n        height="16"\n        width="16"\n        aria-hidden="true"\n        viewBox="0 0 128 128" \n        fill="currentColor"\n        class="e-9800-icon e-9800-baseline"\n      >\n        \n    \x3c!-- Background circle (optional, might be handled by button style) --\x3e\n    \x3c!-- <circle cx="64" cy="64" r="60" fill="#1DB954"/> --\x3e\n    \n    \x3c!-- Album art frame --\x3e\n    <rect x="32" y="32" width="64" height="64" rx="4" fill="none" stroke="currentColor" stroke-width="2"/>\n    \n    \x3c!-- Corner arrows --\x3e\n    \x3c!-- Top-left --\x3e\n    <path d="M32 48 L32 32 L48 32" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n    \n    \x3c!-- Top-right --\x3e\n    <path d="M96 48 L96 32 L80 32" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n    \n    \x3c!-- Bottom-left --\x3e\n    <path d="M32 80 L32 96 L48 96" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n    \n    \x3c!-- Bottom-right --\x3e\n    <path d="M96 80 L96 96 L80 96" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n    \n    \x3c!-- Center focus dot --\x3e\n    <circle cx="64" cy="64" r="12" fill="currentColor"/>\n  \n      </svg>\n    </span>\n  ',(e=>{y?N():H()}),!1);try{h.register()}catch(e){}}(),Spicetify.Player.addEventListener("songchange",T),setTimeout(T,500)}()})();